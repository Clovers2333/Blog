# 数字逻辑与计算机组成

> 我也不好说是谁的问题，反正系统课我一个字也听不下去。
>
> 《数字逻辑与计算机组成》由南京大学袁春风主编，此书和系统所涉及的内容类似，所以选择用这本书作为 计算机系统I 学习的主线，在本文档中也会同步一些上课内容。

## 2. 数字逻辑基础

### 2.1.2 数字抽象

主要以 CMOS 逻辑电路为例。

CMOS 逻辑电路工作在 5 V 或更低的电源电压下，0~1.5 V 称为低电平；3.5~5.0 V 称为高电平；1.5~3.5 V 称为不确定状态。

- $V_{OHmin}$：输出为最高态时的最小输出电压值，一般为 $V_{cc}-0.1V$.
- $V_{OLmax}$：输出为最低态时的最大输出电压值，一般为 $V_{GND}+0.1V$.
- $V_{IHmin}$：输入端能识别为高态时的最小输入电压值，一般为 $0.7V_{cc}$.
- $V_{1Lmax}$：输入端能识别为低态时的最大输入电压值，一般为 $0.3V_{cc}$.

CMOS 的一大优点就是静态功耗较低，所以输出电压波动会比较小；而输入电压受外部其他电路电压不稳定等影响，所以波动会比较大。

**直流噪声容限（DC noise margin）**：所允许的最大噪声幅度，即在这个限度下前一级输出最坏还能保证后一级的输入能正常工作。（ $NM_h=V_{OHmin}-V_{IHmin}$ ）

### 2.1.3 CMOS 晶体管

晶体管三个端子分别称为栅极（gate）、源级（source）和漏极（drain），通过比较栅极和源极之间的电压差，来决定源极和漏极之间为截止还是导通。

- NMOS 晶体管：即 NPN 三级管，栅极为高电平时导通。
- PMOS 晶体管：即 PNP 三极管，栅极为低电平时导通。

通常较多输入端的门电路可用较小输入端的门电路级联而构成，反而速度更快、体积更小。一般来说输入端的数目不超过 8 个。

CMOS 非门、与非门、或非门都采用较少的晶体管电路来构造，统称为反相门。在这三种逻辑门的输出端再接一个非门，则可分别构成缓冲器、与门和或门。

**缓冲器**：输出和输入有相同的逻辑值，但是在时序上不同。

**传输门**：通过 CMOS 的截断和导通，实现开关的效果（一对 CMOS 晶体管，两个三极管）

### 2.1.4 CMOS 电路电气特性

#### 1. 转换时间

实际电路输出从低态到高态、从高态到低态都有转换时间，且上升时间和下降时间很可能不相同。

#### 2. 传输延迟

从输入信号发生变化到输出信号发生变化所需的时间。

#### 3. 功率损耗

- 静态损耗：数字电路在输出信号保持不变的功率损耗，CMOS 的静态损耗很低。
- 动态损耗：高低状态转换时的功率损耗。

### 2.3.3 逻辑函数的标准表示

- SOP（Sum of Product）：多个乘积项的或运算；“最小项”，变量仅在下标时取真值。
- POS（Product of Sum）：多个求和项的与运算；“最大项”，变量仅在下标时取非值。
- 逻辑运算优先级：非 > 与、与非 > 异或、同或 > 或、或非

### 2.4.2 卡诺图化简

- 格雷码，上下、左右、首尾都是相邻的单元；看圈时，一个圈对应的逻辑式——逻辑值不变的变量写进去，01 都有的变量不用写进去。
- 原则：圈少、圈大、不缺不漏。



## 3. 组合逻辑电路

### 概述

- 数字逻辑电路被划分成（带有输入和输出的黑盒）：组合逻辑电路、时序逻辑电路。
- 组合逻辑电路（combinational logic circuit）：输出值仅依赖于当前输入值。
- 时序逻辑电路（sequential logic circuit）：输入值与之前的输入有关。
- 满足“组合逻辑电路”的规则：
    1. 每个元件本身是组合逻辑电路。
    2. 不存在一个节点同时是两个元件的输出或同时被两个元件的输出信号所驱动。
    3. 不存在从一个输入端经过若干元件和中间节点到达一个输出端，然后输出端连回输入端的回路（无反馈）。
- 组合逻辑电路中实现的输入输出关系可以用逻辑表达式或者真值表来描述。
- 一个逻辑门的输入端个数和输出端信号能驱动的下一级门的数量都是有限的，前者最大值称为扇入系数，后者最大值被称为扇出系数。

### 3.1.5 非法值和高阻态

- 非法值：同一个节点同时被高电平和低电平驱动。
- 高阻态：如三态门（有一个使能 E，若 E 有效则输出=输入，否则断开输入输出），断开的状态被称为高阻态。

### 3.2 典型组合逻辑部件

- 译码器：输入端个数 < 输出端，将编码转化为具体的信号。
- 编码器：输入端个数 > 输出端，将较多的信息进行编码。
    - 优先权编码器：例如把二进制位数相同的编同样的编码，那么每一位的编码优先级不同，只有高位为 0 的情况下才能考虑低位。（所有高位往低位插与门）
- 多路选择器：多个输入，通过选择信号选一个输出（复位多路选择器：n 个数据，那么重复 n 次门电路）
- 多路分配器：一个输入，选择一条网线输出。

#### 半加器和全加器

- 不考虑低位进位，仅考虑两个加数的为半加器。

- 记半加器当前位结果为 $F$，向高位的进位为 $Cout$​，则：
  
    $$
    \begin{aligned}
    F&=A\oplus B \\
    Cout &= A\cdot B
    \end{aligned}
    $$

- 在半加器基础上考虑低位进位称为全加器，记低位进位为 $Cin$，则：
  
    $$
    \begin{aligned}
    F&=A\oplus B\oplus Cin \\
    Cout &= A\cdot B + A\cdot Cin + B \cdot Cin
    \end{aligned}
    $$

### 3.3.1 传输延迟和最小延迟

- $t_{pHL}$：下降沿电路延迟； $t_{pLH}$：上升沿电路延迟。
- 通常取信号转换的中点来测量电路的延迟时间。
- 传输延迟 $T_{pd}$：输入端变化开始到**所有**输出端得到最终稳定的信号所需的最长时间。
- 最小延迟 $T_{cd}$：输入端变化开始到**任何一个**输出开始发生改变所需要的最短时间。
- 关键路径：输出和输入之间经过的最长路径。

### 3.3.2 竞争冒险

——在信号变化的过程中有一些尖峰（毛刺）

- 静态冒险（改变信号后稳定状态不变）
    - 功能冒险：多个变量变化，多个信号的变化快慢不同，在时间差内有毛刺。
    - 逻辑冒险：单/多变量变化，一个信号原值和取非都出现，并且两种信号的速度不一样。
- 动态冒险（改变信号后稳定状态变化，即 0->1->0->1）



## 5. FPGA 设计和硬件描述语言

- FPGA: Field Programmable Gate Array（现场可编程门阵列）
- ASIC: Application-Specific Integrated Circuit（专用集成电路）

![](https://github.com/Clovers2333/picx-images-hosting/raw/master/FGPA_intro.1zi0q2jm6a.webp)

CPU---GPU---FPGA/ASIC

对于并行运算，后面比前面强；通用性前面比后面强。

### 5.1.1 可编程逻辑器件（PLD）

- PROM 结构
- PLA 结构
- PAL 结构
- GAL 结构
- CPLD 结构

### 5.1.2 存储器阵列

#### 静态 RAM

#### 动态 RAM

#### ROM

### 5.1.3 FPGA 设计概述

- 基于查找表（Look-Up Table，LUT，巨大真值表）

### 5.2.2 基于 HDL 的数字电路设计流程

1. HDL 编码：编写各种 verilog 文件。
2. 仿真：利用 testbench，进行仿真。
3. 综合（Synthesis）：
    - 代码解析（parsing）
    - 多级综合（multi-level synthesis），将语言真正解析为电路描述（LUT？）
    - 工艺映射（technology mapping）：将电路描述进一步转换成工艺的标准单元（和晶元产商（物理板）提供的标准单元库对应）（映射文件 `top.v`，`nexysa7.xdc`?（这只是输入输出引脚映射））
4. 物理设计（vivado 里面的 Implement？）
    - 布局（mapping）：确定每个标准单元在三维空间中的位置。
    - 布线（routing）：在三维空间中通过物理走线将相应的标准单元连接起来。
    - 静态时序分析（static timing analysis）：根据标准单元和走线延时信息，报告最大频率和延时情况。
    - 电路规则与检查（如两根线太近而短路）
    - 生成物理结果（对于 FPGA，生成比特流文件）

### 5.3 Verilog 语言设计

详见 [Verilog Cheatsheet](https://clovers2333.github.io/Clovers-Blog/cs/system/v_cheatsheet/).